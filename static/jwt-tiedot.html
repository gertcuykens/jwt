<polymer-element name="jwt-tiedot" attributes="jwt">
	<template>
        <style>
		    body{
                -webkit-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
                font-family: 'RobotoDraft', sans-serif;
            }
		</style>
		<section>
			<form>
	            <paper-input label="Email" value="{{email}}" type="email"></paper-input>
	            <paper-input label="Password" value="{{password}}" type="password"></paper-input>
			</form>
			<paper-fab style="margin-left:270px" icon="send" on-tap="{{submit}}"></paper-fab>
		</section>
    </template>
    <script>
        Polymer('jwt-tiedot', {
			
			email:"",
			password:"",
			jwt:"",
			
			getJwt : function (data) {
			    var xhr = new XMLHttpRequest()
			    xhr.open('POST', '/getJwt', true)
			    xhr.responseType = 'json'
			    xhr.onload = function(e) {
					  if (e.target.status == 200) {
						  this.jwt=e.target.getResponseHeader("Authorization")
						  this.checkJwt()
	  					  this.jwTiedot()
					  }
			    }.bind(this)
			    xhr.send(data)
			},
			
			checkJwt : function () {
			    var xhr = new XMLHttpRequest()
			    xhr.open('GET', '/checkJwt', true)
			    xhr.setRequestHeader ("Authorization", this.jwt)
			    xhr.responseType = 'json'
			    xhr.onload = function(e) {
					if (this.status == 200) {
						//console.log(this.getResponseHeader("Authorization"))
					}
			    }.bind(this)
			    xhr.send();
			},
			
			jwTiedot : function () {
			    var xhr = new XMLHttpRequest();
			    xhr.open('GET', '//localhost:8080/all', true)
			    xhr.setRequestHeader ("Authorization", this.jwt)
			    xhr.responseType = 'json'
			    xhr.onload = function(e) {
				    if (this.status == 200) {
				        //console.log(this.getResponseHeader("Authorization"))
				    }
			    }
			    xhr.send()
			},
					
			submit:function(){
                //var re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
                //if (!re.test(this.email)) console.log("No valid email")
                var event = new CustomEvent("submit", {"detail":{"code":200}});
                var form = this.shadowRoot.querySelector('form')
                form.dispatchEvent(event)
            },
			
			ready:function(){
			    var form = this.shadowRoot.querySelector('form')
                form.addEventListener('submit', function(e) {
                    e.preventDefault()
                    var data = new FormData(e.target);
                    data.append("email",this.email)
					 data.append("password",this.password)
                    this.getJwt(data)
                }.bind(this))
			}
			        
		})
    </script>
</polymer-element>